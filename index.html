      
<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Verbalbeurteilungs-Assistent Kl. 5/6 (BW)</title>
    <style>
        :root {
            --primary-color: #007bff; /* Ein frischeres Blau */
            --secondary-color: #6c757d;
            --light-gray: #f8f9fa;
            --medium-gray: #e9ecef;
            --dark-gray: #343a40;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            --border-radius: 0.3rem;
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            margin: 0;
            background-color: var(--light-gray);
            color: var(--dark-gray);
            padding: 20px;
        }

        .container {
            background-color: #fff;
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-width: 850px;
            margin: 20px auto;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-weight: 600;
        }
        
        h2 {
            color: var(--dark-gray);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-top: 30px;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .input-group, .category-section {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            box-sizing: border-box;
            font-size: 1rem;
        }
        input[type="text"]:focus, textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25);
            outline: none;
        }

        textarea {
            height: 200px;
            resize: vertical;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.2s ease-in-out;
            margin-right: 10px;
            margin-top: 10px;
        }

        button:hover {
            background-color: #0056b3; /* Dunkleres Primärblau */
        }
        
        button.secondary {
            background-color: var(--secondary-color);
        }
        button.secondary:hover {
            background-color: #545b62;
        }

        .gender-options label, .text-module-options label, .grade-options label {
            font-weight: normal;
            display: inline-flex; /* Für Radio-Buttons nebeneinander und vertikale Zentrierung */
            align-items: center;
            margin-right: 15px;
            cursor: pointer;
        }
        .gender-options input[type="radio"], .text-module-options input[type="radio"], .grade-options input[type="radio"] {
            width: auto;
            margin-right: 8px;
            accent-color: var(--primary-color); /* Färbt den Radio-Button selbst */
        }
        
        .text-module-options div {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            background-color: #fff;
            transition: background-color 0.2s;
        }
        .text-module-options div:hover {
            background-color: #f0f8ff; /* Helles AliceBlue */
        }
        .text-module-options div input[type="radio"] {
            vertical-align: top; /* Text neben Radio-Button besser ausgerichtet */
            margin-top: 4px; /* Feinanpassung */
        }
        .text-module-options div label {
            display: inline; /* Damit der Text neben dem Radio bleibt */
            line-height: 1.4;
        }


        .category-section {
            padding: 20px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            background-color: #fdfdfd;
        }

        .error-message {
            color: var(--danger-color);
            font-weight: bold;
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid var(--danger-color);
            border-radius: var(--border-radius);
            background-color: #f8d7da;
        }
        
        hr {
            border: none;
            border-top: 1px solid var(--medium-gray);
            margin-top: 30px;
            margin-bottom: 30px;
        }

        /* Horizontale Notenauswahl */
        .grade-selection-container {
            display: flex;
            gap: 10px; /* Abstand zwischen den Radio-Buttons */
            margin-bottom: 15px;
            flex-wrap: wrap; /* Falls nicht genug Platz, umbrechen */
        }
        .grade-selection-container .grade-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }
        .grade-selection-container .grade-option input[type="radio"] {
            margin-right: 6px;
        }
        .grade-selection-container .grade-option:hover {
            background-color: #e9f5ff;
        }
        .grade-selection-container .grade-option input[type="radio"]:checked + label {
             /* Bereits durch accent-color abgedeckt, hier ggf. weitere Styles für den Text */
        }
        /* Visuelle Hervorhebung des ausgewählten Labels (optional) */
        .grade-selection-container .grade-option input[type="radio"]:checked ~ span {
            font-weight: bold;
            color: var(--primary-color);
        }


    </style>
</head>
<body>
    <div class="container">
        <h1>Verbalbeurteilungs-Assistent Kl. 5/6 (BW)</h1>

        <div id="errorDisplay" class="error-message" style="display: none;"></div>

        <div class="input-group">
            <label for="studentName">Name des Schülers/der Schülerin:</label>
            <input type="text" id="studentName" placeholder="Max Mustermann / Erika Mustermann">
        </div>

        <div class="input-group gender-options">
            <label>Geschlecht:</label>
            <input type="radio" id="genderMale" name="gender" value="male" checked>
            <label for="genderMale">Männlich</label>
            <input type="radio" id="genderFemale" name="gender" value="female">
            <label for="genderFemale">Weiblich</label>
        </div>

        <hr>

        <!-- Kategorie Arbeitshaltung -->
        <div class="category-section">
            <h2>A. Arbeitshaltung</h2>
            <div class="input-group">
                <label>Note:</label>
                <div class="grade-selection-container" id="gradeArbeitshaltungContainer" data-category="Arbeitshaltung">
                    <!-- Radio-Buttons für Noten werden hier per JS erstellt -->
                </div>
            </div>
            <div id="textModulesArbeitshaltung" class="text-module-options">
                <!-- Textbausteine werden hier dynamisch eingefügt -->
            </div>
        </div>

        <!-- Kategorie Selbstständigkeit -->
        <div class="category-section">
            <h2>B. Selbstständigkeit</h2>
            <div class="input-group">
                <label>Note:</label>
                <div class="grade-selection-container" id="gradeSelbststaendigkeitContainer" data-category="Selbstständigkeit">
                    <!-- Radio-Buttons für Noten werden hier per JS erstellt -->
                </div>
            </div>
            <div id="textModulesSelbststaendigkeit" class="text-module-options">
                <!-- Textbausteine werden hier dynamisch eingefügt -->
            </div>
        </div>

        <!-- Kategorie Sozial- und Kooperationsverhalten -->
        <div class="category-section">
            <h2>C. Sozial- und Kooperationsverhalten</h2>
            <div class="input-group">
                <label>Note:</label>
                <div class="grade-selection-container" id="gradeSozialverhaltenContainer" data-category="Sozial- und Kooperationsverhalten">
                    <!-- Radio-Buttons für Noten werden hier per JS erstellt -->
                </div>
            </div>
            <div id="textModulesSozialverhalten" class="text-module-options">
                <!-- Textbausteine werden hier dynamisch eingefügt -->
            </div>
        </div>

        <hr>

        <div class="action-area">
            <button id="generateReportButton">Beurteilung generieren und anzeigen</button>
            <br><br>
            <label for="reportOutput">Generierte Beurteilung:</label>
            <textarea id="reportOutput" readonly placeholder="Die generierte Beurteilung erscheint hier..."></textarea>
            <button id="copyReportButton" class="secondary">Beurteilung in Zwischenablage kopieren</button>
        </div>
    </div>

    <script>
        const CATEGORY_KEYS = {
            ARBEITSHALTUNG: "Arbeitshaltung",
            SELBSTSTAENDIGKEIT: "Selbstständigkeit",
            SOZIALVERHALTEN: "Sozial- und Kooperationsverhalten"
        };

        // Textbausteine (wie zuvor)
        const textModules = [
            // Arbeitshaltung
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 1, id: "A1.1", text: "{Name} zeigt stets eine vorbildliche Arbeitshaltung. {er_sie} arbeitet äußerst fleißig, sorgfältig und ausdauernd an allen Aufgaben und ist stets bestrebt, bestmögliche Ergebnisse zu erzielen." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 1, id: "A1.2", text: "Mit großem Engagement und bemerkenswerter Konzentration widmet sich {Name} den gestellten Aufgaben. {sein_ihr} Fleiß und {sein_ihr}e Sorgfalt sind dabei besonders hervorzuheben." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 1, id: "A1.3", text: "{Name} beeindruckt durch {sein_ihr}e durchweg hohe Lernbereitschaft und mustergültige Arbeitshaltung. {er_sie} erledigt alle Aufgaben sehr gewissenhaft und mit großer Ausdauer." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 1, id: "A1.4", text: "{Name} zeichnet sich durch eine herausragende Arbeitsmoral aus. {er_sie} erfasst Aufgaben schnell, arbeitet äußerst gründlich und zeigt eine bemerkenswerte Fähigkeit, sich auch in komplexe Inhalte intensiv einzuarbeiten." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 2, id: "A2.1", text: "{Name} zeigt eine gute Arbeitshaltung. {er_sie} arbeitet fleißig, meist sorgfältig und zielstrebig an den gestellten Aufgaben." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 2, id: "A2.2", text: "{Name} ist ein lernbereiter {Respektpronomen}, der die Aufgaben in der Regel engagiert und konzentriert bearbeitet. {sein_ihr} Fleiß und {sein_ihr}e Sorgfalt sind lobenswert." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 2, id: "A2.3", text: "{Name} arbeitet zuverlässig und gewissenhaft. {er_sie} zeigt eine gute Ausdauer und bemüht sich stets um sorgfältige Ergebnisse." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 2, id: "A2.4", text: "{Name} beteiligt sich rege am Unterricht und erledigt {sein_ihr}e Aufgaben mit durchgehend gutem Einsatz und angemessener Sorgfalt. {sein_ihr}e Lernbereitschaft ist positiv zu bewerten." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 3, id: "A3.1", text: "{Name}s Arbeitshaltung ist insgesamt zufriedenstellend. {er_sie} arbeitet in der Regel mit, benötigt aber gelegentlich Impulse, um Aufgaben sorgfältig und ausdauernd zu bearbeiten." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 3, id: "A3.2", text: "{Name} zeigt eine überwiegend positive Arbeitshaltung, lässt jedoch manchmal in Fleiß und Sorgfalt nach. Mit zusätzlicher Motivation kann {er_sie} {sein_ihr}e Leistungen steigern." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 3, id: "A3.3", text: "{Name} erledigt die gestellten Aufgaben meist, könnte aber noch mehr Ausdauer und Genauigkeit bei der Bearbeitung zeigen." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 3, id: "A3.4", text: "{Name} zeigt phasenweise guten Arbeitseinsatz, lässt sich aber auch leicht ablenken. Um konstante Ergebnisse zu erzielen, sollte {er_sie} an {sein_ihr}er Konzentration und Sorgfalt arbeiten." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 4, id: "A4.1", text: "{Name}s Arbeitshaltung weist Schwächen auf. {er_sie} arbeitet oft flüchtig und zeigt wenig Ausdauer, sodass Aufgaben häufig unvollständig oder fehlerhaft bleiben." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 4, id: "A4.2", text: "{Name} benötigt häufige Ermutigungen und Anleitung, um sich den Aufgaben zu widmen. Fleiß und Sorgfalt müssen deutlich verbessert werden." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 4, id: "A4.3", text: "Die Lernbereitschaft von {Name} ist noch entwicklungsfähig. {er_sie} lässt sich leicht ablenken und zeigt nur geringe Anstrengungsbereitschaft." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 5, id: "A5.1", text: "{Name}s Arbeitshaltung ist mangelhaft. {er_sie} zeigt kaum Fleiß oder Sorgfalt und verweigert sich häufig den gestellten Aufgaben." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 5, id: "A5.2", text: "{Name} arbeitet sehr nachlässig und ohne erkennbare Anstrengung. {er_sie} benötigt ständige und intensive Betreuung, um überhaupt tätig zu werden." },
            { category: CATEGORY_KEYS.ARBEITSHALTUNG, grade: 5, id: "A5.3", text: "Eine positive Arbeitshaltung ist bei {Name} kaum zu erkennen. {er_sie} zeigt weder Lernbereitschaft noch Ausdauer und beeinträchtigt durch {sein_ihr} Verhalten oft den Arbeitsfluss." },

            // Selbstständigkeit
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 1, id: "S1.1", text: "{Name} arbeitet äußerst selbstständig und zeigt dabei ein hohes Maß an Eigeninitiative und Verantwortungsbereitschaft. {er_sie} findet kreative Lösungswege für Probleme." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 1, id: "S1.2", text: "{Name} beeindruckt durch {sein_ihr}e Fähigkeit, Aufgaben eigenverantwortlich zu planen, durchzuführen und zu reflektieren. {er_sie} ergreift von sich aus die Initiative und übernimmt gerne Verantwortung." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 1, id: "S1.3", text: "Mit großer Selbstständigkeit und Organisationsgeschick meistert {Name} auch komplexe Aufgaben. {sein_ihr}e Eigeninitiative und {sein_ihr} Verantwortungsbewusstsein sind vorbildlich." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 1, id: "S1.4", text: "{Name} organisiert {sein_ihr}e Lernprozesse hervorragend selbst und benötigt kaum Anleitung. {er_sie} zeigt große Entschlossenheit, gestellte Probleme eigenständig zu lösen und übernimmt volle Verantwortung für {sein_ihr} Handeln." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 2, id: "S2.1", text: "{Name} arbeitet gut selbstständig und zeigt Eigeninitiative. {er_sie} ist verantwortungsbewusst und kann Aufgaben strukturiert angehen." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 2, id: "S2.2", text: "{Name} erledigt Aufgaben zunehmend eigenständig und zuverlässig. {er_sie} zeigt Verantwortungsbereitschaft und bringt eigene Ideen ein." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 2, id: "S2.3", text: "Die Selbstständigkeit von {Name} ist gut ausgeprägt. {er_sie} übernimmt Verantwortung für {sein_ihr} Lernen und arbeitet zielorientiert." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 2, id: "S2.4", text: "{Name} plant {sein_ihr}e Arbeitsschritte schon recht gut und kann die meisten Aufgaben ohne ständige Hilfe bewältigen. {er_sie} zeigt dabei eine gute Portion Eigeninitiative." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 3, id: "S3.1", text: "{Name} arbeitet phasenweise selbstständig, benötigt aber noch Anleitung und Unterstützung bei der Planung und Durchführung von Aufgaben." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 3, id: "S3.2", text: "{Name} zeigt Ansätze von Eigeninitiative, könnte aber noch mehr Verantwortung für {sein_ihr}e Aufgaben übernehmen. Die Selbstorganisation ist entwicklungsfähig." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 3, id: "S3.3", text: "{Name} kann Aufgaben nach Anleitung selbstständig bearbeiten, tut sich aber schwer, eigene Lösungswege zu finden oder Initiative zu ergreifen." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 3, id: "S3.4", text: "{Name} traut sich zunehmend zu, Aufgaben selbstständig zu beginnen, fragt aber bei Unsicherheiten noch häufig nach. Die Bereitschaft, Verantwortung zu übernehmen, wächst." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 4, id: "S4.1", text: "{Name} zeigt wenig Selbstständigkeit und benötigt bei den meisten Aufgaben detaillierte Anleitung und engmaschige Kontrolle." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 4, id: "S4.2", text: "Eigeninitiative und Verantwortungsbereitschaft sind bei {Name} kaum ausgeprägt. {er_sie} wartet meist auf Anweisungen und zeigt wenig Bereitschaft, Probleme eigenständig anzugehen." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 4, id: "S4.3", text: "{Name} tut sich schwer mit selbstständigem Arbeiten und der Übernahme von Verantwortung. {sein_ihr}e Arbeitsweise ist oft unstrukturiert." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 5, id: "S5.1", text: "{Name} ist kaum in der Lage, selbstständig zu arbeiten. {er_sie} ist auf ständige Anleitung angewiesen und zeigt keinerlei Eigeninitiative oder Verantwortungsbereitschaft." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 5, id: "S5.2", text: "Selbstständiges Arbeiten und Verantwortungsübernahme stellen für {Name} eine große Überforderung dar. {er_sie} ist durchweg auf fremde Hilfe angewiesen." },
            { category: CATEGORY_KEYS.SELBSTSTAENDIGKEIT, grade: 5, id: "S5.3", text: "{Name} zeigt keinerlei Ansätze von Selbstständigkeit. {er_sie} vermeidet jede Form von Eigenverantwortung und benötigt permanente Beaufsichtigung." },

            // Sozial- und Kooperationsverhalten
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 1, id: "SK1.1", text: "{Name} ist wegen {sein_ihr}er freundlichen, hilfsbereiten und zuvorkommenden Art bei Mitschülern und Lehrkräften gleichermaßen sehr geschätzt und beliebt. {er_sie} trägt maßgeblich zu einem positiven Klassenklima bei." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 1, id: "SK1.2", text: "{Name} zeigt stets vorbildliches Sozialverhalten, ist äußerst kooperativ und übernimmt gerne Verantwortung in der Klassengemeinschaft. {er_sie} kann eigene Bedürfnisse zum Wohle der Gruppe zurückstellen." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 1, id: "SK1.3", text: "{Name} ist sehr empathisch, hilft Schwächeren unaufgefordert und setzt sich für faire Lösungen bei Meinungsverschiedenheiten ein. {er_sie} geht offen und respektvoll auf alle Mitglieder der Schulgemeinschaft zu." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 1, id: "SK1.4", text: "Durch {sein_ihr} rücksichtsvolles, faires und hilfsbereites Auftreten prägt {Name} das Klassenklima sehr positiv und wird von {sein_ihr}en Mitschülern als vertrauensvolle Ansprechperson geschätzt." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 1, id: "SK1.5", text: "{Name} integriert sich vorbildlich in die Klassengemeinschaft, zeigt ein hohes Maß an Teamfähigkeit und trägt aktiv zur Lösung von Konflikten bei. {sein_ihr} Verhalten ist stets von Fairness und Respekt geprägt." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 2, id: "SK2.1", text: "{Name} ist ein freundlicher und aufgeschlossener {Respektpronomen}, der sich gut in die Klassengemeinschaft einfügt und gerne mit anderen zusammenarbeitet." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 2, id: "SK2.2", text: "{Name} verhält sich seinen Mitschülern gegenüber hilfsbereit und kooperativ. {er_sie} ist kontaktfreudig und trägt zu einer angenehmen Atmosphäre bei." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 2, id: "SK2.3", text: "{Name} findet schnell Anschluss und pflegt einen guten Umgang mit {sein_ihr}en Mitschülern. {er_sie} zeigt sich meist rücksichtsvoll und unterstützt gemeinsame Vorhaben." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 2, id: "SK2.4", text: "{Name} ist ein anständiger und höflicher {Respektpronomen}, der durch {sein_ihr}e kameradschaftliche und hilfsbereite Art positiv auffällt." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 2, id: "SK2.5", text: "{Name} zeigt sich in der Regel teamfähig und kompromissbereit. {er_sie} ist bei Mitschülern beliebt und kann gut in Gruppen arbeiten, wobei {er_sie} sich an Absprachen hält." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 3, id: "SK3.1", text: "{Name} kommt mit {sein_ihr}en Mitschülern meist gut aus, sollte aber noch lernen, andere Meinungen konsequenter zu akzeptieren und Kompromissbereitschaft zu zeigen." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 3, id: "SK3.2", text: "{Name} ist um ein gutes Verhältnis zu {sein_ihr}en Mitschülern bemüht, verhält sich aber nicht immer kooperativ. {er_sie} hilft, wenn {er_sie} darum gebeten wird." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 3, id: "SK3.3", text: "{Name} fügt sich überwiegend gut in die Klassengemeinschaft ein, könnte sich aber noch aktiver an gemeinsamen Aufgaben beteiligen und mehr Rücksicht auf andere nehmen." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 3, id: "SK3.4", text: "{Name} tritt im Allgemeinen korrekt auf, reagiert aber manchmal unüberlegt oder vertritt {sein_ihr}e Meinung zu stark, ohne die Bedürfnisse anderer zu berücksichtigen." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 3, id: "SK3.5", text: "{Name} findet langsam seinen Platz in der Klassengemeinschaft. In Partner- oder Gruppenarbeiten kooperiert {er_sie} meist, benötigt aber manchmal klare Strukturen und Anreize zur aktiven Teilnahme." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 4, id: "SK4.1", text: "{Name}s Verhalten gegenüber Mitschülern und Lehrkräften ist nicht immer angemessen. {er_sie} reagiert manchmal ungeduldig oder respektlos und hat Schwierigkeiten, Regeln einzuhalten." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 4, id: "SK4.2", text: "{Name} hat mitunter Probleme im Umgang mit {sein_ihr}en Mitschülern und provoziert gelegentlich Konflikte. {er_sie} muss lernen, die Gefühle anderer mehr zu achten." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 4, id: "SK4.3", text: "{Name} bemüht sich phasenweise um ein angemessenes Verhalten, zeigt aber im Umgang mit anderen nicht immer die nötige Ernsthaftigkeit und Toleranz. Es fällt {ihm_ihr} schwer, eigene Bedürfnisse zurückzustellen." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 4, id: "SK4.4", text: "{Name} könnte durch ein rücksichtsvolleres und faireres Verhalten {sein_ihr}e Anerkennung in der Klasse steigern. {er_sie} benötigt Unterstützung, um Konflikte konstruktiv zu lösen." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 4, id: "SK4.5", text: "{Name} zieht sich oft zurück und beteiligt sich wenig am Klassengeschehen. Im Umgang mit Mitschülern ist {er_sie} manchmal unsicher oder abweisend, was die Zusammenarbeit erschwert." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 5, id: "SK5.1", text: "{Name}s Verhalten gibt häufig Anlass zu Kritik und entspricht oft nicht den Anforderungen des Schulalltags. Respektloses Auftreten und das Provozieren von Konflikten sind leider an der Tagesordnung." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 5, id: "SK5.2", text: "{Name} zeigt kaum Verständnis oder Hilfsbereitschaft und verhält sich gegenüber Mitschülern oft rücksichtslos und impulsiv, teilweise auch aggressiv." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 5, id: "SK5.3", text: "Es gelingt {Name} nicht, sich angemessen in die Klassengemeinschaft einzufügen. {sein_ihr} Verhalten führt häufig zu Auseinandersetzungen, die das Eingreifen von Lehrkräften erfordern." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 5, id: "SK5.4", text: "{Name} zeigt kaum Bereitschaft, Regeln zu akzeptieren oder Rücksicht auf andere zu nehmen. {er_sie} lehnt kooperative Arbeitsformen meist ab und isoliert sich." },
            { category: CATEGORY_KEYS.SOZIALVERHALTEN, grade: 5, id: "SK5.5", text: "{Name} stört häufig den Unterricht und missachtet wiederholt Anweisungen von Lehrkräften sowie grundlegende Regeln des Zusammenlebens, wodurch das Lernklima für alle stark beeinträchtigt wird." }
        ];


        // DOM-Elemente
        const studentNameInput = document.getElementById('studentName');
        const genderRadios = document.querySelectorAll('input[name="gender"]');
        const reportOutput = document.getElementById('reportOutput');
        const errorDisplay = document.getElementById('errorDisplay');

        const gradeRadioContainers = {
            [CATEGORY_KEYS.ARBEITSHALTUNG]: document.getElementById('gradeArbeitshaltungContainer'),
            [CATEGORY_KEYS.SELBSTSTAENDIGKEIT]: document.getElementById('gradeSelbststaendigkeitContainer'),
            [CATEGORY_KEYS.SOZIALVERHALTEN]: document.getElementById('gradeSozialverhaltenContainer')
        };

        const textModuleContainers = {
            [CATEGORY_KEYS.ARBEITSHALTUNG]: document.getElementById('textModulesArbeitshaltung'),
            [CATEGORY_KEYS.SELBSTSTAENDIGKEIT]: document.getElementById('textModulesSelbststaendigkeit'),
            [CATEGORY_KEYS.SOZIALVERHALTEN]: document.getElementById('textModulesSozialverhalten')
        };
        
        const gradeLabels = {
            1: "Sehr Gut (1)",
            2: "Gut (2)",
            3: "Befriedigend (3)",
            4: "Ausreichend (4)",
            5: "Ungenügend (5)"
        };

        // Funktion zur Pronomen-Ersetzung
        function getPronouns(gender) {
            if (gender === 'male') {
                return {
                    "{er_sie}": "er",
                    "{sein_ihr}": "sein",
                    "{ihn_sie}": "ihn",
                    "{ihm_ihr}": "ihm",
                    "{Respektpronomen}": "der Schüler"
                };
            } else { // female
                return {
                    "{er_sie}": "sie",
                    "{sein_ihr}": "ihr",
                    "{ihn_sie}": "sie",
                    "{ihm_ihr}": "ihr",
                    "{Respektpronomen}": "die Schülerin"
                };
            }
        }

        // Funktion zum Personalisieren eines Textbausteins
        function personalizeText(text, studentName, pronouns) {
            if (!text) return ""; // Guard clause
            let personalized = text.replace(/{Name}/g, studentName || "{Name}"); // Fallback, falls Name leer
            for (const placeholder in pronouns) {
                personalized = personalized.replace(new RegExp(placeholder.replace(/([\{\}])/g, "\\$1"), 'g'), pronouns[placeholder]);
            }
            return personalized;
        }

        // Funktion zum Anzeigen der Textbausteine für eine Kategorie und Note
        function displayTextModules(categoryKey, grade, studentName, pronouns) {
            const container = textModuleContainers[categoryKey];
            container.innerHTML = ''; // Alte Bausteine löschen

            const relevantModules = textModules.filter(
                module => module.category === categoryKey && module.grade === parseInt(grade)
            );

            relevantModules.forEach((module, index) => {
                const div = document.createElement('div');
                const radioId = `${categoryKey.replace(/\s+/g, '')}-${grade}-${index}`;
                
                const radio = document.createElement('input');
                radio.type = 'radio';
                radio.name = `textModule-${categoryKey.replace(/\s+/g, '')}`; // Name für Radio-Gruppe
                radio.value = module.text; // Rohtext als Wert speichern
                radio.id = radioId;
                if (index === 0) { // Ersten Baustein vorauswählen
                    radio.checked = true;
                }

                const label = document.createElement('label');
                label.htmlFor = radioId;
                // Personalisiere den Text für die Anzeige
                label.textContent = personalizeText(module.text, studentName, pronouns);

                div.appendChild(radio);
                div.appendChild(label);
                container.appendChild(div);
            });
        }
        
        // Funktion, um alle Textbaustein-Anzeigen zu aktualisieren
        // Wird aufgerufen bei Namens- oder Geschlechtsänderung
        function updateAllDisplayedTextModules() {
            const name = studentNameInput.value.trim() || "Schüler/in"; // Fallback für leeren Namen
            const gender = document.querySelector('input[name="gender"]:checked').value;
            const pronouns = getPronouns(gender);

            Object.keys(CATEGORY_KEYS).forEach(keyName => {
                const categoryKey = CATEGORY_KEYS[keyName];
                const selectedGradeRadio = document.querySelector(`input[name="grade-${categoryKey.replace(/\s+/g, '')}"]:checked`);
                if (selectedGradeRadio) {
                    const grade = selectedGradeRadio.value;
                    displayTextModules(categoryKey, grade, name, pronouns);
                }
            });
        }
        
        // Erstellt die horizontalen Radio-Buttons für die Notenauswahl
        function createGradeRadioButtons() {
            Object.keys(gradeRadioContainers).forEach(categoryKey => {
                const container = gradeRadioContainers[categoryKey];
                const categoryId = categoryKey.replace(/\s+/g, ''); // Für eindeutige Namen

                for (let i = 1; i <= 5; i++) {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'grade-option';

                    const radio = document.createElement('input');
                    radio.type = 'radio';
                    radio.name = `grade-${categoryId}`; // Eindeutiger Name pro Kategorie
                    radio.value = i;
                    radio.id = `grade-${categoryId}-${i}`;
                    if (i === 1) { // Note 1 vorauswählen
                        radio.checked = true;
                    }
                    
                    // Event Listener für Notenänderung
                    radio.addEventListener('change', (event) => {
                        const currentName = studentNameInput.value.trim() || "Schüler/in";
                        const currentGender = document.querySelector('input[name="gender"]:checked').value;
                        const currentPronouns = getPronouns(currentGender);
                        displayTextModules(categoryKey, event.target.value, currentName, currentPronouns);
                    });

                    const label = document.createElement('label');
                    label.htmlFor = `grade-${categoryId}-${i}`;
                    
                    const labelText = document.createElement('span'); // Für zusätzliches Styling des Texts
                    labelText.textContent = gradeLabels[i];

                    label.appendChild(radio); // Radio-Button in Label für besseres Klickverhalten
                    label.appendChild(labelText);

                    optionDiv.appendChild(label); // Verwende das äußere Label für das div
                    container.appendChild(optionDiv);
                }
            });
        }

        // Initiales Laden der Textbausteine
        function initializeModules() {
            createGradeRadioButtons(); // Zuerst die Noten-Radios erstellen
            updateAllDisplayedTextModules(); // Dann die Bausteine basierend auf Standardauswahl laden
        }


        // Event Listener für "Beurteilung generieren"
        document.getElementById('generateReportButton').addEventListener('click', () => {
            errorDisplay.textContent = '';
            errorDisplay.style.display = 'none';

            const name = studentNameInput.value.trim();
            const genderRadio = document.querySelector('input[name="gender"]:checked');

            // Validierung
            let errors = [];
            if (!name) {
                errors.push("Bitte geben Sie den Namen des Schülers/der Schülerin ein.");
            }
            if (!genderRadio) { // Sollte nicht passieren, da einer vorausgewählt ist
                errors.push("Bitte wählen Sie das Geschlecht aus.");
            }
            
            const gender = genderRadio ? genderRadio.value : 'male'; // Fallback, falls doch kein Radio
            const pronouns = getPronouns(gender);

            let report = `Zur allgemeinen Beurteilung von ${name || 'Schüler/in'} lässt sich für die aktuelle Beurteilungsperiode Folgendes festhalten:\n\n`;
            let allCategoriesSelected = true;
            
            const getSelectedModuleText = (categoryKey) => {
                const radio = document.querySelector(`input[name="textModule-${categoryKey.replace(/\s+/g, '')}"]:checked`);
                if (radio) {
                    return personalizeText(radio.value, name, pronouns); // Wichtig: Hier den Rohtext personalisieren
                }
                allCategoriesSelected = false;
                return null;
            };

            const arbeitshaltungText = getSelectedModuleText(CATEGORY_KEYS.ARBEITSHALTUNG);
            if (arbeitshaltungText) {
                report += `Im Bereich der Arbeitshaltung ${arbeitshaltungText}\n\n`;
            }

            const selbststaendigkeitText = getSelectedModuleText(CATEGORY_KEYS.SELBSTSTAENDIGKEIT);
            if (selbststaendigkeitText) {
                let linkingPhraseSelbst = "Hinsichtlich {sein_ihr}er Selbstständigkeit ist festzustellen, dass ";
                linkingPhraseSelbst = personalizeText(linkingPhraseSelbst, name, pronouns);
                report += `${linkingPhraseSelbst}${selbststaendigkeitText}\n\n`;
            }

            const sozialverhaltenText = getSelectedModuleText(CATEGORY_KEYS.SOZIALVERHALTEN);
            if (sozialverhaltenText) {
                let linkingPhraseSozial = "Das Sozial- und Kooperationsverhalten von {Name} gestaltet sich wie folgt: ";
                linkingPhraseSozial = personalizeText(linkingPhraseSozial, name, pronouns);
                report += `${linkingPhraseSozial}${sozialverhaltenText}\n`;
            }
            
            if (!allCategoriesSelected && errors.length === 0) { // Nur wenn Name da ist, aber Bausteine fehlen
                 errors.push("Bitte wählen Sie für jede Kategorie einen Textbaustein aus.");
            }

            if (errors.length > 0) {
                errorDisplay.innerHTML = errors.join("<br>");
                errorDisplay.style.display = 'block';
                if (!name) studentNameInput.focus();
                return;
            }

            reportOutput.value = report.trim();
        });

        // Event Listener für "Kopieren"-Button
        document.getElementById('copyReportButton').addEventListener('click', () => {
            if (reportOutput.value) {
                navigator.clipboard.writeText(reportOutput.value)
                    .then(() => {
                        // Kurze Bestätigung direkt am Button (optional)
                        const originalText = document.getElementById('copyReportButton').textContent;
                        document.getElementById('copyReportButton').textContent = 'Kopiert!';
                        setTimeout(() => {
                            document.getElementById('copyReportButton').textContent = originalText;
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Fehler beim Kopieren: ', err);
                        alert('Fehler beim Kopieren in die Zwischenablage.');
                    });
            } else {
                 errorDisplay.textContent = 'Es gibt keine Beurteilung zum Kopieren.';
                 errorDisplay.style.display = 'block';
            }
        });
        
        // Event Listener für Namens- und Geschlechtsänderung, um Bausteine dynamisch zu aktualisieren
        studentNameInput.addEventListener('input', updateAllDisplayedTextModules);
        genderRadios.forEach(radio => {
            radio.addEventListener('change', updateAllDisplayedTextModules);
        });

        // Beim Laden der Seite:
        document.addEventListener('DOMContentLoaded', () => {
            initializeModules();
        });

    </script>
</body>
</html>

    
